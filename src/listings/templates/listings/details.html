{% extends "_base.html" %}

{% load static %}

{% block title %}Details{% endblock%}

{% block content%}
<main class="container bg-light text-dark border rounded-4 shadow-sm">
    <section class="d-flex align-items-center my-3">
        <h4 class="title">{{ listing.title }}</h4>
    </section>

    <!-- Listing photos -->
    <section class="row mb-3">
        {% if listing.get_photos %}
        <div class ="carousel slide" id="photos-carousel" >
            <!-- The carousel itself -->
            <div class ="carousel-inner" >
                {% for photo in listing.get_photos %}
                    <div class ="carousel-item {% if forloop.first %}active{% endif %}" >
                        <img
                                src = "{{ photo.get_details }}"
                                alt = "{{ photo.title }}"
                                class ="d-block w-100">
                            <div class ="carousel-caption d-none d-md-block bg-secondary opacity-50 rounded-2" >
                                <h5>{{ forloop.counter }} {{ photo.title }}</h5>
                            </div>
                    </div>
                {% endfor %}
            </div>
            <!-- Navigation controls -->
            <button class="carousel-control-prev"
                    data-bs-slide="prev"
                    data-bs-target="#photos-carousel">
                <span class="carousel-control-prev-icon"></span>
                <span class="visually-hidden">Previous</span>
            </button>
            <button class="carousel-control-next"
                    data-bs-slide="next"
                    data-bs-target="#photos-carousel">
                <span class="carousel-control-next-icon"></span>
                <span class="visually-hidden">Next</span>
            </button>
        </div>
        {% else %}
        <img src="{% static 'images/defaults/listing_details.webp' %}" alt="{{ listing.title }}" class="img-fluid card-img-top">
        {% endif %}
    </section>

    <!-- Main data -->
    <section class="row border rounded-3 m-1">
        <dl>
            <dt class="col-3 d-inline-block">Type:</dt><dd class="col-9 d-inline-block">{{ listing.object_type.name }}</dd>
            <dt class="col-3 d-inline-block">Description:</dt><dd class="col-9 d-inline-block">{{ listing.description }}</dd>
            <dt class="col-3 d-inline-block">Max guests:</dt><dd class="col-9 d-inline-block">{{ listing.max_guests }}</dd>
            <dt class="col-3 d-inline-block">Bedrooms:</dt><dd class="col-9 d-inline-block"> {{ listing.bedrooms }}</dd>
            <dt class="col-3 d-inline-block">Beds:</dt><dd class="col-9 d-inline-block">{{ listing.beds }}</dd>
            <dt class="col-3 d-inline-block">Bathrooms:</dt><dd class="col-9 d-inline-block">{{ listing.bathrooms }}</dd>
            <dt class="col-3 d-inline-block">Check-in:</dt><dd class="col-9 d-inline-block">{{ listing.check_in_time|time:"H:i" }}</dd>
            <dt class="col-3 d-inline-block">Check-out:</dt><dd class="col-9 d-inline-block"> {{ listing.check_out_time|time:"H:i" }}</dd>
            <dt class="col-3 d-inline-block">Instant booking:</dt><dd class="col-9 d-inline-block "> {{ listing.instant_booking }}</dd>
        </dl>
    </section>

    <!-- Amenities -->
    <section class="row border rounded m-1">
        <dl class="mt-3">
            <dt>Amenities:</dt>
            <dd>
                <ul class="list-group list-group-horizontal">
                    {% for amenity in listing.amenities.all %}
                        <li class="list-group-item">{{ amenity.name }}</li>
                    {% endfor %}
                </ul>
            </dd>
        </dl>

        <dl>
            <dt>House rules:</dt>
            <dd>
                <ul class="list-group list-group-horizontal">
                    {% for rule in listing.house_rules.all %}
                        <li class="list-group-item"> {{ rule.name }} </li>
                    {% endfor %}
                </ul>
            </dd>
        </dl>
    </section>

    <!-- Price tags -->
    <section class="row border rounded m-1">
        <dl>
            <dt>Prices:</dt>
            <dd>
                <ul class="list-group list-group-vertical">
                    {% for price_tag in listing.price_tags.all %}
                        <li class="list-group-item"> {{ price_tag.start_date|date:"M d, Y" }} - {{ price_tag.end_date|date:"M d, Y" }}: {{ price_tag.price }} </li>
                    {% endfor %}
                </ul>
            </dd>
        </dl>
    </section>

    <!-- Avalable dates -->
    <section class="row border rounded m-1">
        <dl>
            <dt>Avalable dates</dt>
            <dd>
                <button hx-get="{% url 'listings:listing_calendar' listing.slug current_month %}">Show calendar</button>
            </dd>
        </dl>
    </section>

    <!-- Reservation form -->
    <section class="row border rounded m-1">
        <dl>
            <dt>Reservation:</dt>
            <dd>
                {% if user.is_authenticated %}
                    {% include "listings/includes/reservation_form.html" %}
                {% else %}
                    <p>Please <a href="{% url 'account_login' %}">log in</a> or <a href="{% url 'account_signup' %}">register</a> to view available dates and submit for reservation </p>
                {% endif %}
            </dd>
        </dl>
    </section>
</main>
{% endblock %}